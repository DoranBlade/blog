---
title: "变量和指针"
date: 2017-12-30T23:30:03+08:00
tags: ["computer", "c++"]
---

探究java/js,c++/go语言间的变量差异
<!--more-->

## 变量
在c++中声明一个变量,先需要在内存中找到合适大小的内存区域用于存放变量数据,并通过变量名来访问这些数据.下面声明了一个age变量,对于该变量的访问都需要通过该变量来进行

``` c++
int main() {
    int age = 12;
    age = 20;
    cout << age << "\n";
}
```

这种对于变量的处理方式,在java/js/golang等语言中大致都一致.以下面Java为例(可以看出c++和Java很多语法有很多的相似)

``` java
public static void main(String[] args) {
    int age  = 12;
    age = 20;
    System.out.print(age);
}
```

 在变量的使用上,c++和Java等语言都采用值传递的方式传递变量.Java/js等在变量上根据其在内存中存储的结构,区分变量为值类型变量和引用类型变量.而在c++中非指针特性的变量均是采用值类型的方式来对待。下面以c++的struct和Java的类来做比较.
 先看看c++的例子,下面例子中作为复合类型的struct变量,传递给变量时传递的使其所有数据的副本.

 ``` c++
struct Dog {
    string name;
    int age;
};
int main() 
{
    Dog a = {"tom", 12};
    Dog b = a;
    a.age = 20;
    // b.age = 12
    cout << b.age << "\n";
}
```

Java的例子中,作为复合类型的class变量,传递给变量时传递的时其对数据的引用地址。在c++中则需要借助指针实现这样的效果

``` java
public class Dog {
    String name;
    int age;

    public static void main(String[] args) {
        Dog a = new Dog();
        a.name = "tom";
        a.age = 12;
        Dog b = a;
        a.age = 20;
        // b.age = 20;
        System.out.print(b.age);
    }
}
```

## 指针
在c++,golang等编译时语言中，都开放了对于指针的权限，方便对内存进行精确的管理。继续上面的例子，c++中通过指针实现Java中的引用类型传递。

``` c++
struct Dog {
    string name;
    int age;
};
int main() 
{
    Dog a = {"tom", 12};
    Dog * b = &a;
    a.age = 20;
    // b.age = 20
    cout << b -> age << "\n";
}
```

不仅仅是复杂结构的数据，对于基础数据类型也可以通过指针达到引用类型的效果。而这些在Java中是无法实现。

``` c++
int main() 
{
    int a = 10;
    int * b = &a;
    *b = 20;
    // a = 20
    cout << a << "\n";
}
```

通过上面的比较可以发现在Java中对于变量采用哪种方式来定义是由语言规范默认的，不提供自动切换的选项。在c++中对于变量采用哪种方式来定义控制权在用户手里。

## 值类型和引用类型的利弊
为什么会存在值类型和引用类型两种类型的变量呢？这两种方式的变量均存在优缺点，最优解需要根据使用场景而定。

### 值类型
值类型的变量的优点是变量在传递时的安全性，通俗点讲就是变量a传递给变量b后，两个变量的任何操作都不会影响到另外一个变量。而引用类型就在传递时，两个变量都使用同一个内存空间，一个变量的任何操作都会影响到另外一个变量。所以在Java/js等不提供指针的语言中，某些时候会需要手动clone一个对象的。

下面的c++例子中，结构体Dog的变量在传递时采用值传递，形参和实参各自拥有不同的内存空间，两者互不受影响。
``` c++
// 定义原型
void scale(Dog dog);
// 定义结构体
struct Dog {
    string name;
    int age;
};
int main() 
{
    Dog a = {"tom", 12};
    scale(a);
    // a.age = 12
    cout << a.age << "\n";
}
// 定义函数
void scale(Dog dog) {
    dog.age *= 2;
}
```

值类型的缺点是会消耗更多的内存空间。值类型变量在传递的过程中都需要复制一个副本，对于体积比较大的数据类型，都会消耗更多的cpu时间和内存空间。

### 引用类型
引用类型变量的优缺点与值类型变量的优缺点刚好相反。引用类型的变量在传递的过程中值赋值其内存空间的地址，所有在CPU时间和内存空间上消耗都是最小的，缺点是传递时缺乏安全性。所以在使用引用类型的变量时需要留意对于变量的修改的影响是否符合预期。

Java语言中对于变量的默认分类，大体总结了两种变量类型的使用场景。对于体积小的基础数据类型使用值类型的结构，对于体积大的复杂数据类型使用引用类型的结构。但对于特殊情况时，就需要使用非常方式来处理。如果对象需要保持传递的安全性时，需要手动创建副本。如果值类型不需要保持传递的安全性，则需要包装到复杂结构内传递。
